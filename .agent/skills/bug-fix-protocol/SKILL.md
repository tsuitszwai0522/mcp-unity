---
name: bug-fix-protocol
description: 當使用者回報 Bug、錯誤 (Error)、異常行為 (Incorrect Behavior) 或提出問題 (Issue) 時使用。
---

# Bug Fix Protocol

此 Skill 用於規範錯誤修復流程，強制執行「先分析，後修復」的原則。

## 核心規則 (Core Rules)
1.  **語言要求**：所有分析報告與溝通必須使用 **zh-TW**。
2.  **禁止搶跑**：在使用者明確 **Approve (批准)** 修復方案之前，**嚴格禁止**直接修改專案原始碼。
3.  **檔案優先 (File Only)**：
    * **必須**將完整的分析報告存檔至 `doc/bugFix/`。
    * **禁止**在對話視窗中輸出報告全文。
    * 僅需告知使用者：「分析報告已建立，請查看：[檔案路徑]」。

## 執行流程 (Workflow)

### 第一階段：分析與診斷 (Analysis & Diagnosis)
當使用者回報問題時：

1.  **建立檔案**：
    * 在 `doc/bugFix/` 目錄下建立一個 Markdown 報告。
    * 命名規則：`Fix_{YYYYMMDD}_{IssueSummary}.md` (例如：`Fix_20260115_PlayerCantJump.md`)。
    * 若目錄不存在，請先建立。

2.  **撰寫報告內容**：
    報告必須包含以下章節：
    * **1. 問題描述 (Issue Description)**：
        * 重述使用者的問題，確認理解無誤。
        * 記錄相關的錯誤訊息 (Logs) 或異常現象。
    * **2. 根源分析 (Root Cause Analysis)**：
        * *這是最重要的部分*。不要只看表面，要推測導致錯誤的底層邏輯（例如：Race Condition、Null Reference、State Machine 錯誤轉移）。
        * 考慮專案特定的架構影響（生命週期、並發、資料庫交易等）。
    * **3. 建議修復方案 (Proposed Solution)**：
        * 提供具體的 **Code Snippet**，展示修復後的樣子。
        * 如果有多種修復方式（例如：快速修補 vs 架構重構），請列出並比較。
    * **4. 副作用評估 (Side Effects)**：
        * 這個修改可能會影響哪些其他功能？
        * 是否需要更新測試案例？

3.  **通知使用者**：僅需告知使用者：「分析報告已建立，請查看：[檔案路徑]」。

### 第二階段：審閱與批准 (Review & Approve)
1.  **詢問使用者**：請使用者確認分析是否正確，並選擇修復方案。
2.  **修正分析**：如果使用者指出分析有誤，請更新 Markdown 檔案並重新思考根源。

### 第三階段：執行修復 (Execution)
當使用者明確表示「批准」或「修復它」 (Approve) 後：

1.  **應用代碼**：根據報告中的方案修改原始碼。
2.  **清理工作**：(選用) 建議使用者執行相關測試 (`test-engineer` skill) 以確保沒有 Regression。

## 觸發時機 (When to use)
* 使用者說：「我發現一個 Bug...」
* 使用者貼上一段 Error Log 並問原因。
* 使用者說：「為什麼這個功能的行為怪怪的？」
* 使用者說：「這段代碼跑不動。」

## 禁止事項 (Don'ts)
1. ❌ 未完成分析報告就開始修改代碼
2. ❌ 在對話視窗中輸出完整報告
3. ❌ 跳過副作用評估
4. ❌ 未經批准就執行修復
